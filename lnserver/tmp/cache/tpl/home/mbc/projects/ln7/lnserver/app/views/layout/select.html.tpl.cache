(display "<!-- project#add view template of lnserver
          Please add your license header here.
          This file is generated automatically by GNU Artanis.         
        https://www.w3schools.com/js/js_htmldom_eventlistener.asp  
           -->
  
")(display "<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01//EN\" \"http://www.w3.org/TR/html4/strict.dtd\">
<html>
  <head>
 <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />
    <title>LIMS*Nucleus </title>
    <link rel=\"alternate\" type=\"application/atom+xml\" title=\"Atom 1.0\" href=\"atom/1\" />
    <link rel=\"stylesheet\" type=\"text/css\" media=\"screen\" href=\"../css/common.css\" />
    
    </head>
<!-- Side navigation -->
<div class=\"sidenav\">
<style>
img {
  display: block;
  margin-left: auto;
  margin-right: auto;
}
</style>
<img src=\"../img/las-nav-bar.png\" alt=\"Laboratory Automation Solutions\" style=\"width:120px;height:180px;\">

  <a href=\"../project/getall\">Projects</a>
  <a href=\"../layout/getall\">Layouts</a>
  <a href=\"../target/gettrglyt\">Targets</a>
  <a href=\"../utilities/setup\">Utilities</a>

<a href=\"../sessions/getall\">Sessions</a>
<a href=\"../users/getall\">Users</a>

  <a href=\"../utilities/help?topic=")(display  help-topic )(display " \">HELP</a>
  <a href=\"http://labsolns.com/software/toc\">TOC</a>
  <a href=\"mailto:info@labsolns.com\">Contact</a>

  SID: ")(display  sid )(display "
</div>
<div class=\"main\">
")(display "

  <h1>Select Layout For Import</h1><br><br>

   <input type=\"hidden\" id=\"infile\" name=\"infile\" value= ")(display  infile )(display " >
  <form action=\"/layout/import?id=id$value\">

 <label for=\"myfile\">Select a layout file for import.</label>
 <label for=\"myfile\">The file must contain 96, 384, or 1536 rows of data.</label>
<input type=\"file\" accept=\".txt\" id=\"myfile\" name=\"myfile\"> 
</form> 
  
<script>
  function readSingleFile(e) {
      var file = e.target.files[0];
      if (!file) {
	  return;
      }
      var reader = new FileReader();
      reader.onload = function(e) {
	  var contents = e.target.result;
	  var numrows = lineCount(contents);
	  var format = numrows -1
	  var fname = file.name;
	  
	  if( numrows === 97 || numrows === 385 || numrows === 1537){
	        let formData = new FormData();
                formData.append(\"contents\", contents);
        //        var link='/upload?format=' + format + \"&origfile=\" + fname;
                  var link='/upload';
                fetch(link, {method: \"POST\", body: formData});    
                      
	    
	  window.open( '/layout/viewlayout', \"_top\");
	 // displayContents(contents);
    	  }else{
    	  var message1=\"Layout Import file must have 96, 384 or 1536 rows of data.\\n\";
    	  var message2 = numrows.toString();
    	  var message3 = \" rows were found. Please try again.\";
    	  var message4 = message1.concat(message2, message3);
	  window.alert(message4);
             }
      };
      reader.readAsText(file);
  }
  
  
  
  function displayContents(contents) {
      var element = document.getElementById('file-content');
      element.innerHTML = contents;
  }

 
  function lineCount( text ) {
      var nLines = 0;
      var allLines = text.split('\\n');
      for( var i = 0, n = allLines.length;  i < n;  ++i ) {
           if( allLines[i].length > 0  ) {
               ++nLines;
           }
       }
       return nLines;
 }

  
  document.getElementById('myfile').addEventListener('change', readSingleFile, false);
</script>
  
  
<div id=\"file-content\"></div>
  
")(display "</div></html>")(display "

")